---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Astro - Tic-Tac-Toe" currentPage="tictactoe">
  <div class="container text-center mt-5">
    <h1 class="mb-4">Tic-Tac-Toe</h1>
    <div id="game" class="d-grid mx-auto" style="grid-template-columns: repeat(3, 100px); grid-gap: 10px; width: 320px;"></div>
    <p id="status" class="mt-3 fs-5">Player X's turn</p>
    <button id="resetBtn" class="btn btn-primary mt-3">Reset Game</button>
  </div>
</Layout>

<style>
  .btn.btn-outline-dark.cell {
    width: 100px !important;
    height: 100px !important;
    font-size: 2rem !important;
  }
</style>

<script>
  const board = Array(9).fill(null);
  let currentPlayer = "X";
  const gameEl = document.getElementById("game");
  const statusEl = document.getElementById("status");
  const resetBtn = document.getElementById("resetBtn");

  function renderBoard() {
    if (!gameEl) return;
    gameEl.innerHTML = "";
    board.forEach((cell, i) => {
      const btn = document.createElement("button");
      btn.className = "btn btn-outline-dark cell";
      btn.style.width = "100px";
      btn.style.height = "100px";
      btn.style.fontSize = "2rem";
      btn.textContent = cell || "";
      btn.onclick = () => handleClick(i);
      gameEl.appendChild(btn);
    });
  }

  function handleClick(i: number) {
    if (board[i] || checkWinner()) return;
    board[i] = currentPlayer;
    currentPlayer = currentPlayer === "X" ? "O" : "X";
    renderBoard();
    const winner = checkWinner();
    if (winner) {
      if (statusEl) statusEl.textContent = `${winner} wins!`;
    } else if (!board.includes(null)) {
      if (statusEl) statusEl.textContent = "It's a draw!";
    } else {
      if (statusEl) statusEl.textContent = `Player ${currentPlayer}'s turn`;
    }
  }

  function checkWinner() {
    const lines = [
      [0,1,2],[3,4,5],[6,7,8],
      [0,3,6],[1,4,7],[2,5,8],
      [0,4,8],[2,4,6]
    ];
    for (let [a,b,c] of lines) {
      if (board[a] && board[a] === board[b] && board[a] === board[c]) {
        return board[a];
      }
    }
    return null;
  }

  function resetGame() {
    for (let i=0; i<board.length; i++) board[i] = null;
    currentPlayer = "X";
    if (statusEl) statusEl.textContent = "Player X's turn";
    renderBoard();
  }

  // Initialize
  document.addEventListener('DOMContentLoaded', () => {
    renderBoard();
    if (resetBtn) resetBtn.onclick = resetGame;
  });
</script>
