<div class="container mt-5">
    <h1 class="mb-4">Todo List</h1>

    <!-- Add Task Form -->
    <form (ngSubmit)="addTask()" class="row g-3 mb-4">
        <div class="col-md-6">
            <input type="text" class="form-control" placeholder="Enter new task" [(ngModel)]="taskInput"
                name="taskInput" required />
        </div>
        <div class="col-md-4">
            <input type="datetime-local" class="form-control" [(ngModel)]="completionDate" name="completionDate" />
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn btn-primary w-100">
                Add Task
            </button>
        </div>
    </form>

    <!-- Task List -->
    <ul class="list-group">
        @for (task of tasks; track task.id; let i = $index) {
        <li class="list-group-item d-flex justify-content-between align-items-center"
            [class.dragging]="draggedItem && draggedItem.id === task.id" draggable="true"
            (dragstart)="onDragStart(task)" (dragover)="onDragOver($event)" (drop)="onDrop(i)">
            @if (editingTask === task.id) {
            <form (ngSubmit)="saveEdit()" class="d-flex w-100 align-items-center">
                <input type="text" class="form-control me-2" [(ngModel)]="editTaskName" name="editTaskName" required />
                <input type="datetime-local" class="form-control me-2" [(ngModel)]="editDate" name="editDate" />
                <button type="submit" class="btn btn-sm btn-primary me-2">
                    Save
                </button>
                <button type="button" class="btn btn-sm btn-secondary" (click)="cancelEdit()">
                    Cancel
                </button>
            </form>
            } @else {
            <div class="flex-grow-1">
                <span [class.text-decoration-line-through]="task.completed">
                    {{ task.task }} (Due: {{ formatDate(task.completionDate) }})
                </span>
            </div>
            <div>
                <button class="btn btn-sm btn-success me-2" (click)="toggleComplete(task)">
                    {{ task.completed ? 'Undo' : 'Complete' }}
                </button>
                <button class="btn btn-sm btn-warning me-2" (click)="startEdit(task)">
                    Edit
                </button>
                <button class="btn btn-sm btn-danger" (click)="deleteTask(task.id)">
                    Delete
                </button>
            </div>
            }
        </li>
        }
    </ul>
</div>